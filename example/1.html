<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>篮球擦板投篮轨迹</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.min.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Segoe UI', Arial, sans-serif;
            background: #87CEEB;
            color: #333;
        }
        #container {
            position: relative;
            width: 100vw;
            height: 100vh;
        }
        #info {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 8px;
            max-width: 300px;
            box-shadow: 0 0 15px rgba(0,0,0,0.2);
            display: none;
            transition: all 0.3s ease;
        }
        #info.expanded {
            display: block;
        }
        #toggleInfo {
            position: absolute;
            top: 10px;
            left: 10px;
            background: #1E90FF;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            z-index: 100;
            box-shadow: 0 0 10px rgba(0,0,0,0.2);
        }
        #controls {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.85);
            padding: 15px 25px;
            border-radius: 10px;
            display: flex;
            gap: 15px;
            box-shadow: 0 0 15px rgba(0,0,0,0.2);
        }
        button {
            background: #1E90FF;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }
        button:hover {
            background: #0066CC;
            transform: translateY(-2px);
        }
        h1 {
            color: #1E90FF;
            margin-top: 0;
            text-align: center;
            font-size: 22px;
        }
        .info-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        #info.expanded .info-content {
            max-height: 500px;
        }
    </style>
</head>
<body>
    <div id="container"></div>
    
    <button id="toggleInfo">显示信息</button>
    
    <div id="info">
        <h1>篮球擦板投篮轨迹</h1>
        <div class="info-content">
            <p>此场景展示了篮球从A点擦板后到达B点（篮筐中心）和C点的轨迹。</p>
            <p><strong>关键点：</strong></p>
            <ul>
                <li>A点：篮板上的碰撞点（左侧）</li>
                <li>B点：篮筐中心</li>
                <li>C点：A点下方1.8m，水平偏移位置</li>
                <li>O₁点：篮筐在篮板上的投影</li>
            </ul>
            <p><strong>尺寸：</strong></p>
            <ul>
                <li>O₁A = 40cm</li>
                <li>O₁B = 30cm</li>
                <li>AB高度差 = 20cm</li>
            </ul>
            <p><strong>轨迹：</strong></p>
            <ul>
                <li>红色：A点到B点轨迹</li>
                <li>蓝色：A点到C点轨迹</li>
            </ul>
            <p><strong>操作说明：</strong></p>
            <ul>
                <li>鼠标拖动 - 旋转视图</li>
                <li>鼠标滚轮 - 缩放视图</li>
                <li>右键拖动 - 平移视图</li>
            </ul>
        </div>
    </div>
    
    <div id="controls">
        <button id="resetView">重置视图</button>
        <button id="toggleTrajectory">切换轨迹</button>
        <button id="toggleDashedLines">切换虚线</button>
    </div>

    <script>
        // 初始化场景
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x87CEEB);

        // 初始化相机
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(4, 2.5, 4);

        // 初始化渲染器
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        document.getElementById('container').appendChild(renderer.domElement);

        // 添加轨道控制器
        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;

        // 添加环境光
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambientLight);

        // 添加方向光
        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
        directionalLight.position.set(5, 10, 7);
        directionalLight.castShadow = true;
        scene.add(directionalLight);

        // 创建网格地面
        const gridHelper = new THREE.GridHelper(15, 15, 0x444444, 0x222222);
        gridHelper.position.y = 0;
        scene.add(gridHelper);

        // 定义尺寸（单位：米）
        const boardWidth = 1.8;
        const boardHeight = 1.05;
        const boardThickness = 0.05;
        const rimRadius = 0.225;
        const rimThickness = 0.02;
        const rimDistance = 0.3; // 篮筐中心距离篮板0.3米
        const boardBottomHeight = 1.8; // 篮板底部离地高度
        
        // 关键点位置
        const O1 = new THREE.Vector3(0, boardBottomHeight + boardHeight/2 - boardHeight/4, 0); // 篮筐在篮板上的投影
        // A点：O1左侧40cm，上方20cm，接触篮板表面（在篮板前面）
        const A = new THREE.Vector3(-0.4, boardBottomHeight + boardHeight/2 - boardHeight/4 + 0.2, boardThickness/2 + 0.01); 
        const B = new THREE.Vector3(0, boardBottomHeight + boardHeight/2 - boardHeight/4, rimDistance); // B点：篮筐中心
        // C点：A点下方1.8m，水平平行距离1.2m，水平垂直距离1.8m，偏左
        const C = new THREE.Vector3(A.x - 1.2, A.y - 1.8, A.z + 1.8);

        // 创建篮板（白色矩形）
        const boardGeometry = new THREE.BoxGeometry(boardWidth, boardHeight, boardThickness);
        const boardMaterial = new THREE.MeshPhongMaterial({ 
            color: 0xFFFFFF,
            transparent: true,
            opacity: 0.8
        });
        const board = new THREE.Mesh(boardGeometry, boardMaterial);
        board.position.set(0, boardBottomHeight + boardHeight/2, 0);
        board.castShadow = true;
        scene.add(board);


        // 创建篮筐（仅外部环，移除内部所有结构）
        const rimGeometry = new THREE.TorusGeometry(rimRadius, rimThickness, 16, 100);
        const rimMaterial = new THREE.MeshPhongMaterial({ color: 0xFF4500 });
        const rim = new THREE.Mesh(rimGeometry, rimMaterial);
        rim.position.copy(B);
        rim.rotation.x = Math.PI / 2;
        rim.castShadow = true;
        scene.add(rim);

        // 创建关键点标记（无色透明）
        const pointGeometry = new THREE.SphereGeometry(0.03, 16, 16);
        const pointMaterial = new THREE.MeshBasicMaterial({ 
            color: 0x000000,
            transparent: true,
            opacity: 0 // 完全透明
        });
        
        const pointO1 = new THREE.Mesh(pointGeometry, pointMaterial);
        pointO1.position.copy(O1);
        scene.add(pointO1);

        const pointA = new THREE.Mesh(pointGeometry, pointMaterial);
        pointA.position.copy(A);
        scene.add(pointA);

        const pointB = new THREE.Mesh(pointGeometry, pointMaterial);
        pointB.position.copy(B);
        scene.add(pointB);

        const pointC = new THREE.Mesh(pointGeometry, pointMaterial);
        pointC.position.copy(C);
        scene.add(pointC);

        // 创建虚线标注
        const dashedLines = [];
        
        function createDashedLine(start, end, color = 0x0000FF) {
            const material = new THREE.LineDashedMaterial({
                color: color,
                dashSize: 0.05,
                gapSize: 0.03,
            });
            const geometry = new THREE.BufferGeometry().setFromPoints([start, end]);
            const line = new THREE.Line(geometry, material);
            line.computeLineDistances();
            scene.add(line);
            dashedLines.push(line);
            return line;
        }

        // 添加尺寸标注虚线
        createDashedLine(O1, A, 0x0000FF); // O1A = 40cm
        createDashedLine(O1, new THREE.Vector3(O1.x, O1.y, B.z), 0x0000FF); // O1B = 30cm
        createDashedLine(A, new THREE.Vector3(A.x, B.y, A.z), 0x0000FF); // AB高度差 = 20cm

        // 创建A到B的篮球轨迹（红色）
        const trajectoryABPoints = [];
        const trajectoryABGeometry = new THREE.BufferGeometry();
        const trajectoryABMaterial = new THREE.LineBasicMaterial({ 
            color: 0xFF0000, // 红色轨迹
            linewidth: 3
        });
        const trajectoryAB = new THREE.Line(trajectoryABGeometry, trajectoryABMaterial);
        scene.add(trajectoryAB);

        // 创建A到C的篮球轨迹（蓝色）
        const trajectoryACPoints = [];
        const trajectoryACGeometry = new THREE.BufferGeometry();
        const trajectoryACMaterial = new THREE.LineBasicMaterial({ 
            color: 0x0000FF, // 蓝色轨迹
            linewidth: 3
        });
        const trajectoryAC = new THREE.Line(trajectoryACGeometry, trajectoryACMaterial);
        scene.add(trajectoryAC);

        // 计算篮球轨迹（从A点到B点的平抛轨迹）
        function calculateTrajectoryAB() {
            trajectoryABPoints.length = 0;
            
            // 计算水平距离和高度差
            const dx = B.x - A.x; // 水平x方向距离
            const dz = B.z - A.z; // 水平z方向距离
            const horizontalDistance = Math.sqrt(dx * dx + dz * dz); // 总水平距离
            const dy = B.y - A.y; // 垂直高度差
            
            // 重力加速度
            const g = 10; // m/s²
            
            // 计算运动时间（根据竖直方向运动）
            const time = Math.sqrt(-2 * dy / g);
            
            // 计算水平初速度
            const v0 = horizontalDistance / time;
            
            // 计算轨迹点
            for (let i = 0; i <= 50; i++) {
                const t = i / 50 * time;
                
                // 水平方向：匀速运动
                const x = A.x + (dx / horizontalDistance) * v0 * t;
                const z = A.z + (dz / horizontalDistance) * v0 * t;
                
                // 竖直方向：自由落体
                const y = A.y - 0.5 * g * t * t;
                
                trajectoryABPoints.push(new THREE.Vector3(x, y, z));
            }
            
            // 更新轨迹几何体
            trajectoryABGeometry.setFromPoints(trajectoryABPoints);
        }

        // 计算篮球轨迹（从A点到C点的平抛轨迹）
        function calculateTrajectoryAC() {
            trajectoryACPoints.length = 0;
            
            // 计算水平距离和高度差
            const dx = C.x - A.x; // 水平x方向距离
            const dz = C.z - A.z; // 水平z方向距离
            const horizontalDistance = Math.sqrt(dx * dx + dz * dz); // 总水平距离
            const dy = C.y - A.y; // 垂直高度差
            
            // 重力加速度
            const g = 10; // m/s²
            
            // 计算运动时间（根据竖直方向运动）
            const time = Math.sqrt(-2 * dy / g);
            
            // 计算水平初速度
            const v0 = horizontalDistance / time;
            
            // 计算轨迹点
            for (let i = 0; i <= 50; i++) {
                const t = i / 50 * time;
                
                // 水平方向：匀速运动
                const x = A.x + (dx / horizontalDistance) * v0 * t;
                const z = A.z + (dz / horizontalDistance) * v0 * t;
                
                // 竖直方向：自由落体
                const y = A.y - 0.5 * g * t * t;
                
                trajectoryACPoints.push(new THREE.Vector3(x, y, z));
            }
            
            // 更新轨迹几何体
            trajectoryACGeometry.setFromPoints(trajectoryACPoints);
        }

        // 初始化轨迹
        calculateTrajectoryAB();
        calculateTrajectoryAC();

        // 动画循环
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }

        // 窗口大小调整
        window.addEventListener('resize', function() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // 控制按钮功能
        document.getElementById('resetView').addEventListener('click', function() {
            controls.reset();
            camera.position.set(4, 2.5, 4);
            controls.update();
        });

        document.getElementById('toggleTrajectory').addEventListener('click', function() {
            trajectoryAB.visible = !trajectoryAB.visible;
            trajectoryAC.visible = !trajectoryAC.visible;
        });

        document.getElementById('toggleDashedLines').addEventListener('click', function() {
            dashedLines.forEach(line => {
                line.visible = !line.visible;
            });
        });

        // 信息面板切换
        document.getElementById('toggleInfo').addEventListener('click', function() {
            const infoPanel = document.getElementById('info');
            const isExpanded = infoPanel.classList.contains('expanded');
            
            if (isExpanded) {
                infoPanel.classList.remove('expanded');
                this.textContent = '显示信息';
            } else {
                infoPanel.classList.add('expanded');
                this.textContent = '隐藏信息';
            }
        });

        // 开始动画
        animate();
    </script>
</body>
</html>
